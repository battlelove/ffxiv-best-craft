import"./web-source-CLWFJSWP.js";import{E as V}from"./el-scrollbar-CZKsYA5y.js";import{E as J}from"./main-CuW7cZ7r.js";import{a as K,E as A}from"./el-table-column-CPyvtj5C.js";import"./el-checkbox-BdvWVDV9.js";/* empty css               */import{E as F}from"./el-card-BxyCZf4X.js";import{E as I}from"./el-switch-B48mHU6Y.js";import{f as R,k as $,C as O}from"./gearsets--erWGMI9.js";import{e as Q,S as W,A as G}from"./StatusBar-5KKGyJ7C.js";import{a as H}from"./Buffs-CRb8R4Q7.js";import{d as L}from"./injectionkeys-D0C3r-gs.js";import{E as X}from"./index-C-S4NhjY.js";import{y as Y,m as Z,r as u,k as tt,b1 as et,w as at,B as lt,C as ot,K as n,a7 as nt,P as p,u as s,aa as st,a1 as it,an as g,ax as ut}from"./_plugin-vue_export-helper-BFa5o2E7.js";import"./_initCloneObject-BOvqA-K9.js";import"./_baseSlice-F8doVSIJ.js";import"./merge-CE4i3afS.js";import"./_baseIteratee-BFOSDgD8.js";import"./raf-Cyz63Ot6.js";import"./use-form-item-BvI-dC5F.js";import"./el-form-item-D7WeuNod.js";import"./index-Cp9QasH9.js";import"./el-select-B90NG6PW.js";import"./strings-BEQKxX2v.js";import"./use-wheel-CGd7NEq5.js";import"./Condition-9hJadcfx.js";import"./Utils-C7zRsiCb.js";const rt={class:"main-page"},ct={class:"actionpanel"},h=Y({__name:"Simulator",props:{recipe:{},item:{},attributes:{},collectableShopRefine:{}},async setup(i){let l,k;const y=i,x=Z(L),m=u([]),C=tt(()=>{let{level:a,craftsmanship:t,control:o,craft_points:f}=y.attributes;const E=(e,D)=>e+D;return t+=m.value.filter(e=>e.cm&&e.cm_max).map(e=>Math.min(t*e.cm/100,e.cm_max)).reduce(E,0),o+=m.value.filter(e=>e.ct&&e.ct_max).map(e=>Math.min(o*e.ct/100,e.ct_max)).reduce(E,0),f+=m.value.filter(e=>e.cp&&e.cp_max).map(e=>Math.min(f*e.cp/100,e.cp_max)).reduce(E,0),{level:a,craftsmanship:t,control:o,craft_points:f}}),w=u({...([l,k]=et(()=>R(C.value,y.recipe)),l=await l,k(),l),quality:0});at([y,C],async([a,t])=>{w.value={...await R(t,a.recipe),quality:0}});const r=u(w.value),d=u([]),S=u(!1),T=u([]),v=u(!1),_=u(null),b=u(!0);let c;const M=a=>new Promise(t=>setTimeout(t,a));async function U(a){if(!v.value){B();try{let t;v.value=!0,b.value,t=M(b.value?300:1500);const{status:o,is_success:f}=await $(r.value,a,!1);await t,r.value=o,f||(a=a.concat("_fail")),d.value.push({id:d.value.length,action:a,condition:r.value.condition}),(o.progress>=o.recipe.difficulty||o.durability<=0)&&(await M(2500),q())}catch(t){console.error(t)}finally{c!=null&&clearTimeout(c),v.value=!1}}}function q(){T.value.push(r.value),d.value.splice(0),r.value=w.value}function z(a){c!=null&&clearTimeout(c),c=setTimeout(()=>{$(r.value,a,!0).then(t=>_.value={...t.status,condition:O.Normal}).catch(t=>{})},1e3)}function B(){c!=null&&clearTimeout(c),_.value=null}return(a,t)=>(ot(),lt("div",rt,[n(s(J),{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=o=>S.value=o),title:a.$t("meal-and-potion")},{default:p(()=>[n(Q,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=o=>m.value=o)},null,8,["modelValue"])]),_:1},8,["modelValue","title"]),n(W,{class:"status-bar",attributes:i.attributes,enhancers:m.value,status:_.value??r.value,"show-condition":!0,collectableShopRefine:i.collectableShopRefine,onClickAttributes:t[2]||(t[2]=o=>S.value=!0)},null,8,["attributes","enhancers","status","collectableShopRefine"]),n(s(V),{class:"action-queue"},{default:p(()=>[n(H,{job:s(x),list:d.value,disabled:"","no-hover":""},null,8,["job","list"])]),_:1}),nt("div",ct,[n(s(V),{class:"action-panel"},{default:p(()=>[n(G,{onClickedAction:U,disable:v.value,job:s(x),status:r.value,"simulator-mode":"",onMousehoverAction:z,onMouseleaveAction:B},null,8,["disable","job","status"]),n(s(X),{class:"drop",onClick:q,type:"danger"},{default:p(()=>[st(it(a.$t("restart")),1)]),_:1}),n(s(I),{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=o=>b.value=o),"inline-prompt":"","active-text":"高速模式","inactive-text":"真实体验"},null,8,["modelValue"])]),_:1}),n(s(F),{class:"results"},{default:p(()=>[n(s(V),null,{default:p(()=>[n(s(K),{data:T.value},{default:p(()=>[n(s(A),{prop:"step",label:a.$t("steps")},null,8,["label"]),n(s(A),{prop:"progress",label:a.$t("progress")},null,8,["label"]),n(s(A),{prop:"quality",label:a.$t("quality")},null,8,["label"])]),_:1},8,["data"])]),_:1})]),_:1})])]))}});function j(i){const l=i.options||i;l.fluent=l.fluent||{},l.fluent["zh-CN"]=new g(`meal-and-potion = 食物 & 药水
restart = 倒`)}function N(i){const l=i.options||i;l.fluent=l.fluent||{},l.fluent["zh-TW"]=new g(`meal-and-potion = 食物 & 藥水
restart = 倒`)}function P(i){const l=i.options||i;l.fluent=l.fluent||{},l.fluent["en-US"]=new g(`meal-and-potion = Meal & Potions
restart = Restart`)}typeof j=="function"&&j(h);typeof N=="function"&&N(h);typeof P=="function"&&P(h);const Ut=ut(h,[["__scopeId","data-v-c99b617e"]]);export{Ut as default};
//# sourceMappingURL=Simulator-CqXyFEta.js.map
