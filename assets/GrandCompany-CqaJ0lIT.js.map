{"version":3,"file":"GrandCompany-CqaJ0lIT.js","sources":["../../src/pages/GrandCompany.vue"],"sourcesContent":["<template>\n    <div class=\"grand-company-page\">\n        <h2>{{ $t('gc-supply-title') }}</h2>\n        \n        <div class=\"filter-card\">\n            <div class=\"filter-row\">\n                <span class=\"label\">{{ $t('level-range') }}:</span>\n                <el-input-number v-model=\"minLevel\" :min=\"1\" :max=\"100\" size=\"small\" />\n                <span class=\"separator\">-</span>\n                <el-input-number v-model=\"maxLevel\" :min=\"1\" :max=\"100\" size=\"small\" />\n                \n                <el-button type=\"primary\" @click=\"calculateDemand\" :loading=\"calculating\" style=\"margin-left: 20px;\">\n                    {{ $t('calculate-demand') }}\n                </el-button>\n            </div>\n            <p class=\"hint-text\">{{ $t('gc-hint') }}</p>\n        </div>\n\n        <div class=\"content-row\">\n            <!-- Left: GC Items List -->\n            <div class=\"section-card half-width\">\n                <h3>{{ $t('gc-items-list') }} ({{ displayedGCItems.length }})</h3>\n                <el-table :data=\"displayedGCItems\" height=\"500\" style=\"width: 100%\" stripe>\n                    <el-table-column prop=\"level\" label=\"Lv\" width=\"60\" sortable />\n                    <el-table-column prop=\"job\" :label=\"$t('job')\" width=\"80\" sortable />\n                    <el-table-column prop=\"nameTC\" :label=\"$t('item-name')\" />\n                    <el-table-column :label=\"$t('status')\" width=\"100\" align=\"center\">\n                        <template #default=\"scope\">\n                            <el-tag v-if=\"scope.row.isCraftable\" type=\"success\" size=\"small\">{{ $t('craftable') }}</el-tag>\n                            <el-tag v-else type=\"info\" size=\"small\">{{ $t('gathering-or-other') }}</el-tag>\n                        </template>\n                    </el-table-column>\n                </el-table>\n            </div>\n\n            <!-- Right: Material Demand -->\n            <div class=\"section-card half-width\">\n                <h3>{{ $t('material-demand-stats') }}</h3>\n                <p class=\"hint-text\">{{ $t('material-demand-hint') }}</p>\n                \n                <el-table :data=\"materialDemandList\" height=\"500\" style=\"width: 100%\" stripe>\n                    <el-table-column prop=\"name\" :label=\"$t('material-name')\" />\n                    <el-table-column prop=\"amount\" :label=\"$t('total-demand')\" width=\"120\" sortable />\n                    <el-table-column :label=\"$t('type')\" width=\"100\">\n                         <template #default=\"scope\">\n                            <el-tag v-if=\"scope.row.isSubCraft\" type=\"warning\" size=\"small\">{{ $t('intermediate') }}</el-tag>\n                            <el-tag v-else type=\"info\" size=\"small\">{{ $t('raw') }}</el-tag>\n                        </template>\n                    </el-table-column>\n                </el-table>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue';\nimport { ElInputNumber, ElButton, ElTable, ElTableColumn, ElTag, ElMessage } from 'element-plus';\nimport { useFluent } from 'fluent-vue';\nimport { getGCItemsByLevel, GCSupplyItem } from '@/libs/GrandCompanySupply';\nimport { findRecipesByResultItem, findRecipesUsingItem } from '@/libs/RecipeMap';\nimport { searchLocalItem } from '@/libs/ItemMap';\n\nconst { $t } = useFluent();\n\nconst minLevel = ref(1);\nconst maxLevel = ref(50);\nconst calculating = ref(false);\n\ninterface DisplayGCItem extends GCSupplyItem {\n    isCraftable: boolean;\n}\n\ninterface MaterialDemand {\n    id: number;\n    name: string;\n    amount: number;\n    isSubCraft: boolean;\n}\n\nconst displayedGCItems = ref<DisplayGCItem[]>([]);\nconst materialDemandList = ref<MaterialDemand[]>([]);\n\nasync function calculateDemand() {\n    calculating.value = true;\n    displayedGCItems.value = [];\n    materialDemandList.value = [];\n    \n    try {\n        const gcItems = getGCItemsByLevel(minLevel.value, maxLevel.value);\n        \n        const validItems: DisplayGCItem[] = [];\n        const demandMap = new Map<number, MaterialDemand>();\n\n        for (const item of gcItems) {\n             let recipeFound = false;\n             \n             if (item.id) {\n                 const recipes = findRecipesByResultItem(item.id);\n                 if (recipes.length > 0) {\n                     recipeFound = true;\n                     const targetRecipe = recipes[0]; // Assume first recipe (primary)\n                     \n                     // Calculate materials for this item (Assuming 1 item needed per GC turn-in, CSV says quantity but usually it's 1 for gear, maybe more for food?)\n                     // Use 'amount' from CSV if available, else 1\n                     const requiredAmount = item.amount || 1; \n                     // Recipe yield might be > 1 (e.g. food produces 3), so we need ceil(required / yield) * ingredients\n                     const craftsNeeded = Math.ceil(requiredAmount / targetRecipe.yield);\n                     \n                     for (const ing of targetRecipe.ingredients) {\n                         const totalIngQty = ing.amount * craftsNeeded;\n                         \n                         if (!demandMap.has(ing.id)) {\n                             // Check if this ingredient is itself craftable (intermediate)\n                             const subRecipes = findRecipesByResultItem(ing.id);\n                             \n                             demandMap.set(ing.id, {\n                                 id: ing.id,\n                                 name: ing.name,\n                                 amount: 0,\n                                 isSubCraft: subRecipes.length > 0\n                             });\n                         }\n                         \n                         const entry = demandMap.get(ing.id)!;\n                         entry.amount += totalIngQty;\n                     }\n                 }\n             }\n\n             validItems.push({\n                 ...item,\n                 isCraftable: recipeFound\n             });\n        }\n        \n        // Filter: Only show craftable items in the main list? User said \"list all products ... and exclude basic materials (no processing)\". \n        // This likely means: Display the GC items that ARE craftable products.\n        // And for the demand list, \"tell me which semi-finished products are most needed\". \n        \n        displayedGCItems.value = validItems.filter(i => i.isCraftable);\n        \n        // Filter demand list: User wants \"Semi-finished\" mostly.\n        const allDemand = Array.from(demandMap.values());\n        \n        // Let's sort by amount desc\n        materialDemandList.value = allDemand\n            .filter(d => d.isSubCraft) // Only show intermediate materials per request? \"Tell me those 'semi-finished' needs most\"\n            .sort((a, b) => b.amount - a.amount);\n            \n    } catch (e) {\n        console.error(e);\n        ElMessage.error(\"Calculation failed: \" + String(e));\n    } finally {\n        calculating.value = false;\n    }\n}\n</script>\n\n<style scoped>\n.grand-company-page {\n    padding: 20px;\n    height: 100%;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n}\n\n.filter-card {\n    background: var(--el-bg-color-overlay);\n    padding: 20px;\n    border-radius: 8px;\n    margin-bottom: 20px;\n    flex: none;\n}\n\n.filter-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 10px;\n}\n\n.separator {\n    margin: 0 5px;\n}\n\n.hint-text {\n    font-size: 0.9em;\n    color: var(--el-text-color-secondary);\n    margin: 0;\n}\n\n.content-row {\n    display: flex;\n    gap: 20px;\n    flex: auto;\n    overflow: hidden; \n}\n\n.section-card {\n    background: var(--el-bg-color-overlay);\n    padding: 20px;\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n}\n\n.half-width {\n    flex: 1;\n    overflow: hidden;\n}\n\nh3 {\n    margin-top: 0;\n}\n</style>\n\n<fluent locale=\"zh-CN\">\ngc-supply-title = 军需品需求统计\nlevel-range = 等级范围\ncalculate-demand = 计算需求\ngc-hint = 筛选指定等级范围的军需品，并统计所需的半成品数量。\ngc-items-list = 军需品清单 (可制作)\njob = 职业\nitem-name = 物品名称\nstatus = 状态\ncraftable = 可制作\ngathering-or-other = 采集/其他\nmaterial-demand-stats = 半成品需求统计\nmaterial-demand-hint = 仅显示需制作的半成品材料，按需求量排序。\nmaterial-name = 材料名称\ntotal-demand = 总需求\ntype = 类型\nintermediate = 半成品\nraw = 原材料\n</fluent>\n\n<fluent locale=\"zh-TW\">\ngc-supply-title = 軍需品需求統計\nlevel-range = 等級範圍\ncalculate-demand = 計算需求\ngc-hint = 篩選指定等級範圍的軍需品，並統計所需的半成品數量。\ngc-items-list = 軍需品清單 (可製作)\njob = 職業\nitem-name = 物品名稱\nstatus = 狀態\ncraftable = 可製作\ngathering-or-other = 採集/其他\nmaterial-demand-stats = 半成品需求統計\nmaterial-demand-hint = 僅顯示需製作的半成品材料，按需求量排序。\nmaterial-name = 材料名稱\ntotal-demand = 總需求\ntype = 類型\nintermediate = 半成品\nraw = 原材料\n</fluent>\n\n<fluent locale=\"en-US\">\ngc-supply-title = Grand Company Supply Demand\nlevel-range = Level Range\ncalculate-demand = Calculate\ngc-hint = Filter supply items by level and calculate material demand.\ngc-items-list = Supply Items (Craftable)\njob = Job\nitem-name = Item Name\nstatus = Status\ncraftable = Craftable\ngathering-or-other = Gathering/Other\nmaterial-demand-stats = Intermediate Material Demand\nmaterial-demand-hint = Showing only craftable intermediate materials, sorted by demand.\nmaterial-name = Material Name\ntotal-demand = Total Demand\ntype = Type\nintermediate = Intermediate\nraw = Raw\n</fluent>\n"],"names":["$t","useFluent","minLevel","ref","maxLevel","calculating","displayedGCItems","materialDemandList","calculateDemand","gcItems","getGCItemsByLevel","validItems","demandMap","item","recipeFound","recipes","findRecipesByResultItem","targetRecipe","requiredAmount","craftsNeeded","ing","totalIngQty","subRecipes","entry","i","allDemand","d","a","b","e","ElMessage","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_unref","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","_createVNode","ElInputNumber","$event","_cache","ElButton","_hoisted_5","_hoisted_6","_hoisted_7","ElTable","ElTableColumn","_withCtx","scope","_createBlock","ElTag","_hoisted_8","_hoisted_9"],"mappings":"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"}