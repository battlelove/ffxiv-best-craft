{"version":3,"file":"CustomizeRecipe-DMQ81tGF.js","sources":["../../src/components/recipe-manager/CustomizeRecipe.vue"],"sourcesContent":["<!-- \n    This file is part of BestCraft.\n    Copyright (C) 2025  Tnze\n\n    BestCraft is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as published\n    by the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    BestCraft is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <https://www.gnu.org/licenses/>.\n-->\n\n<script setup lang=\"ts\">\nimport { computed, onActivated, ref, watch } from 'vue';\nimport {\n    ElButton,\n    ElInputNumber,\n    ElForm,\n    ElFormItem,\n    ElSwitch,\n    ElCheckboxGroup,\n    ElCheckboxButton,\n    ElScrollbar,\n} from 'element-plus';\nimport { useRouter } from 'vue-router';\nimport { selectRecipe } from './common';\nimport { useFluent } from 'fluent-vue';\nimport {\n    Conditions,\n    Item,\n    Recipe,\n    RecipeLevel,\n    RecipeRequirements,\n} from '@/libs/Craft';\nimport useSettingsStore from '@/stores/settings';\n\nconst router = useRouter();\nconst { $t } = useFluent();\nconst settingStore = useSettingsStore();\n\nconst emit = defineEmits<{\n    (e: 'setTitle', title: string): void;\n}>();\nonActivated(() => emit('setTitle', 'custom-recipe'));\n\nconst autoLoad = ref(false);\nconst autoLoadLoading = ref(false);\n\nconst defaultRecipeLevel: RecipeLevel = {\n    id: 720,\n    class_job_level: 100,\n    stars: 0,\n    suggested_craftsmanship: 4780,\n    suggested_control: null,\n    difficulty: 8050,\n    quality: 17600,\n    progress_divider: 170,\n    quality_divider: 150,\n    progress_modifier: 90,\n    quality_modifier: 75,\n    durability: 70,\n    conditions_flag: 15,\n};\nconst defaultRecipe: Recipe = {\n    rlv: defaultRecipeLevel,\n    job_level: 100,\n    difficulty: 8050,\n    quality: 17600,\n    durability: 70,\n    conditions_flag: 15,\n};\n\nconst rlv = ref(defaultRecipeLevel.id);\nconst customRecipe = ref<Recipe>({\n    ...defaultRecipe,\n    rlv: { ...defaultRecipeLevel },\n});\nconst conditionsFlag = computed<Conditions[]>({\n    get: () => {\n        const flag = customRecipe.value.conditions_flag;\n        return Object.values(Conditions).filter(\n            (_cond, i) => (flag & (1 << i)) != 0,\n        );\n    },\n    set: val => {\n        const flag = Object.values(Conditions)\n            .map((cond, i) => (val.indexOf(cond) >= 0 ? 1 << i : 0))\n            .reduce((a, b) => a | b, 0);\n        customRecipe.value.conditions_flag = flag;\n    },\n});\n\nlet recipeLevelPromise: Promise<RecipeLevel> | null = null;\nwatch(\n    [autoLoad, settingStore.getDataSource, rlv],\n    async ([autoLoadValue, dataSource, rlv]) => {\n        if (!autoLoadValue) return;\n        try {\n            autoLoadLoading.value = true;\n            if (recipeLevelPromise != null) await recipeLevelPromise;\n            const ds = await dataSource;\n            recipeLevelPromise = ds.recipeLevelTable(rlv);\n            customRecipe.value.rlv = await recipeLevelPromise;\n            recipeLevelPromise = null;\n        } catch {\n            autoLoad.value = false;\n        } finally {\n            autoLoadLoading.value = false;\n        }\n    },\n);\n\nfunction confirm(simulatorMode: boolean) {\n    const itemInfo: Item = {\n        id: -1,\n        name: $t('custom-recipe'),\n        level: customRecipe.value.job_level,\n        can_be_hq: true,\n    };\n    const requirements: RecipeRequirements = {\n        required_craftsmanship: 0,\n        required_control: 0,\n    };\n    selectRecipe(\n        customRecipe.value,\n        undefined,\n        0,\n        requirements,\n        undefined,\n        itemInfo,\n        '',\n        simulatorMode,\n    );\n    router.push({ name: 'designer' });\n}\n</script>\n\n<template>\n    <el-scrollbar class=\"container\">\n        <el-form :inline=\"true\" label-position=\"right\" label-width=\"100px\">\n            <el-form-item :label=\"$t('class-job-level')\">\n                <el-input-number\n                    v-model=\"customRecipe.job_level\"\n                    :min=\"1\"\n                ></el-input-number>\n            </el-form-item>\n            <el-form-item :label=\"$t('difficulty')\">\n                <el-input-number\n                    v-model=\"customRecipe.difficulty\"\n                    :min=\"1\"\n                ></el-input-number>\n            </el-form-item>\n            <el-form-item :label=\"$t('quality')\">\n                <el-input-number\n                    v-model=\"customRecipe.quality\"\n                    :min=\"1\"\n                ></el-input-number>\n            </el-form-item>\n            <el-form-item :label=\"$t('durability')\">\n                <el-input-number\n                    v-model=\"customRecipe.durability\"\n                    :min=\"1\"\n                ></el-input-number>\n            </el-form-item>\n            <el-form-item :label=\"$t('conditions')\">\n                <el-checkbox-group v-model=\"conditionsFlag\" size=\"small\">\n                    <el-checkbox-button\n                        v-for=\"cond in Conditions\"\n                        :key=\"cond\"\n                        :value=\"cond as string\"\n                    >\n                        {{ $t(cond.toLowerCase()) }}\n                    </el-checkbox-button>\n                </el-checkbox-group>\n            </el-form-item>\n        </el-form>\n        <el-form :inline=\"true\" label-position=\"right\" label-width=\"100px\">\n            <el-form-item :label=\"$t('recipe-level')\">\n                <el-input-number v-model=\"rlv\" :min=\"1\"></el-input-number>\n            </el-form-item>\n            <el-form-item :label=\"$t('auto-load')\">\n                <el-switch v-model=\"autoLoad\" :loading=\"autoLoadLoading\" />\n            </el-form-item>\n        </el-form>\n        <el-form :inline=\"true\" label-position=\"right\" label-width=\"100px\">\n            <el-form-item :label=\"$t('progress-divider')\">\n                <el-input-number\n                    :disabled=\"autoLoad\"\n                    v-model=\"customRecipe.rlv.progress_divider\"\n                />\n            </el-form-item>\n            <el-form-item :label=\"$t('progress-modifier')\">\n                <el-input-number\n                    :disabled=\"autoLoad\"\n                    v-model=\"customRecipe.rlv.progress_modifier\"\n                />\n            </el-form-item>\n            <el-form-item :label=\"$t('quality-divider')\">\n                <el-input-number\n                    :disabled=\"autoLoad\"\n                    v-model=\"customRecipe.rlv.quality_divider\"\n                />\n            </el-form-item>\n            <el-form-item :label=\"$t('quality-modifier')\">\n                <el-input-number\n                    :disabled=\"autoLoad\"\n                    v-model=\"customRecipe.rlv.quality_modifier\"\n                />\n            </el-form-item>\n        </el-form>\n        <span>\n            <el-button type=\"default\" @click=\"router.back()\">\n                {{ $t('back') }}\n            </el-button>\n            <el-button type=\"primary\" @click=\"confirm(false)\">\n                {{ $t('confirm') }}\n            </el-button>\n            <el-button\n                type=\"primary\"\n                v-if=\"customRecipe.conditions_flag != 15\"\n                @click=\"confirm(true)\"\n            >\n                {{ $t('simulator-mode') }}\n            </el-button>\n        </span>\n    </el-scrollbar>\n</template>\n\n<style scoped>\n.container {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    background-color: transparent !important;\n}\n</style>\n\n<fluent locale=\"zh-CN\">\nback = 返回\ncustom-recipe = 自定义配方\nauto-load = 自动填充\n\ncancel = 取消\nconfirm = 确认\nsimulator-mode = 模拟器模式\n</fluent>\n\n<fluent locale=\"zh-TW\">\nback = 返回\ncustom-recipe = 自定義配方\nauto-load = 自動填充\n\ncancel = 取消\nconfirm = 確認\nsimulator-mode = 模擬器模式\n</fluent>\n\n<fluent locale=\"en-US\">\nback = Back\ncustom-recipe = Custom Recipe\nauto-load = Auto Fill\n\ncancel = Cancel\nconfirm = Confirm\nsimulator-mode = Simulator Mode\n</fluent>\n"],"names":["router","useRouter","$t","useFluent","settingStore","useSettingsStore","emit","__emit","onActivated","autoLoad","ref","autoLoadLoading","defaultRecipeLevel","defaultRecipe","rlv","customRecipe","conditionsFlag","computed","flag","Conditions","_cond","i","val","cond","a","b","recipeLevelPromise","watch","autoLoadValue","dataSource","confirm","simulatorMode","itemInfo","requirements","selectRecipe","_createBlock","_unref","ElScrollbar","_createVNode","ElForm","ElFormItem","ElInputNumber","_cache","$event","ElCheckboxGroup","_createElementBlock","_Fragment","_renderList","ElCheckboxButton","ElSwitch","_createElementVNode","ElButton"],"mappings":"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"}