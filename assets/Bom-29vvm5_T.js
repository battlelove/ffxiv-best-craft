import{y as Z,aG as he,aH as Y,W as be,M as q,C as c,u as e,E as M,P as r,K as i,O as P,aa as w,a1 as I,an as $,ax as J,r as k,aO as T,w as we,aJ as $e,B as h,F as _e,a7 as B,J as x,ar as D,a8 as R,a6 as Ie,aA as ke,ap as qe,aP as ee,k as K,af as Ne,aB as Ee}from"./_plugin-vue_export-helper-BtR51heV.js";import{a8 as xe,a9 as Be,aa as Me,I as te,s as Se,ab as Ve}from"./web-source-Bs5IZlzA.js";import{E as Te,a as Ce}from"./el-card-CSvC8EBz.js";import{q as ne,k as ze,r as Ue,E as De}from"./main-DHDOfIud.js";import{E as Re}from"./el-alert-Bs5pSMtS.js";import{E as A}from"./el-text-CRQSl4YT.js";import{E as Fe}from"./el-switch-DG2KxbeA.js";import{E as Pe}from"./el-scrollbar-N6_PO5M-.js";import{a as le,E as Ae}from"./el-input-number-C14IrUT4.js";import{E as Ze}from"./index-MqTZqqKy.js";import{a as Je,E as Q}from"./el-table-column-BgYqtlaA.js";import"./el-checkbox-VNZMn74g.js";/* empty css               */import{E as F}from"./index-Do6mxMsD.js";import{u as Le}from"./bom-DikZwFrH.js";import"./gearsets-_w_xkUCw.js";import"./use-form-item-B98PJfkl.js";import"./_initCloneObject-De-kUH1l.js";import"./_baseSlice-F8doVSIJ.js";import"./merge-BC_rZDEl.js";import"./_baseIteratee-BkvBa5Vk.js";import"./raf-4nKU6kRM.js";const C=Z({__name:"Item",props:he({id:{},name:{},wasted:{},requiredInputDisabled:{type:Boolean},holdingInputDisabled:{type:Boolean},type:{}},{requiredNumber:{required:!0},requiredNumberModifiers:{},holdingNumber:{required:!0},holdingNumberModifiers:{}}),emits:["update:requiredNumber","update:holdingNumber"],setup(t,{expose:n}){const g=t,p=Y(t,"requiredNumber"),a=Y(t,"holdingNumber"),y=new Map([[void 0,void 0],["required","danger"],["crafted","warning"],["completed","success"],["not-required","info"]]);return n({id:be(()=>g.id)}),(o,u)=>(c(),q(e(Te),{class:M(t.type),"body-class":o.$style.item,shadow:"hover"},{default:r(()=>[i(e(A),{class:M(o.$style["id-badget"]),size:"small",type:"info"},{default:r(()=>[w(" #"+I(t.id),1)]),_:1},8,["class"]),i(e(A),{class:M(o.$style.elem),type:e(y).get(t.type)},{default:r(()=>[w(I(t.name),1)]),_:1},8,["class","type"]),P("",!0),i(e(Ze),{value:t.wasted??0,hidden:t.wasted==null||t.wasted==0,type:"info"},{default:r(()=>[i(e(ne),{class:M(o.$style.elem),content:o.$t("required-number"),effect:"light",enterable:!1},{default:r(()=>[i(e(le),{size:"small",modelValue:p.value,"onUpdate:modelValue":u[0]||(u[0]=v=>p.value=v),"step-strictly":"",min:0,disabled:t.requiredInputDisabled,controls:!t.requiredInputDisabled},{suffix:r(()=>[...u[2]||(u[2]=[w("pcs",-1)])]),_:1},8,["modelValue","disabled","controls"])]),_:1},8,["class","content"])]),_:1},8,["value","hidden"]),i(e(ne),{class:M(o.$style.elem),content:o.$t("holding-number"),effect:"light",enterable:!1},{default:r(()=>[i(e(le),{class:M(o.$style.elem),size:"small",modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=v=>a.value=v),"step-strictly":"",min:0,disabled:t.holdingInputDisabled},{suffix:r(()=>[...u[3]||(u[3]=[w("pcs",-1)])]),_:1},8,["class","modelValue","disabled"])]),_:1},8,["class","content"])]),_:1},8,["class","body-class"]))}}),Oe="_item_y6vrv_2",je="_elem_y6vrv_18",He="_icon_y6vrv_22",We={item:Oe,"id-badget":"_id-badget_y6vrv_11",elem:je,icon:He};function ae(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["zh-CN"]=new $(`required-number = 需求数量
holding-number = 持有数量`)}function ie(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["zh-TW"]=new $(`required-number = 需求數量
holding-number = 持有數量`)}function oe(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["en-US"]=new $(`required-number = Required number
holding-number = Holding number`)}function se(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["ja-JP"]=new $(`required-number = 需要数量
holding-number = 保有数量`)}const Ge={$style:We};typeof ae=="function"&&ae(C);typeof ie=="function"&&ie(C);typeof oe=="function"&&oe(C);typeof se=="function"&&se(C);const re=J(C,[["__cssModules",Ge]]),Ke={key:0,class:"buttons"},L=Z({__name:"Selector",emits:["clickItem","selectItems"],setup(t,{emit:n}){const g=n,p=ze(),a=k(""),y=k([]),o=k(!1),u=T("table");async function v(){try{o.value=!0;const _=await(await p.getDataSource()).recipeTable(1,a.value);y.value=_.results}finally{o.value=!1}}we(a,()=>v(),{immediate:!0});const b=k([]);function j(m){b.value=m}function H(){const m=b.value.map(_=>({id:_.item_id,name:_.item_name}));g("selectItems",m),z()}async function W(m){g("clickItem",{id:m.item_id,name:m.item_name}),z()}function z(){b.value.splice(0),u.value.clearSelection()}return(m,_)=>{const S=$e("tnze-loading");return c(),h(x,null,[_e((c(),q(e(Je),{ref:"table",data:y.value,onRowClick:W,"max-height":"300",onSelectionChange:j},{default:r(()=>[i(e(Q),{type:"selection",width:"55"}),i(e(Q),{prop:"job",label:m.$t("craft-type"),width:"150"},null,8,["label"]),i(e(Q),{prop:"item_name",label:m.$t("name")},{header:r(()=>[i(e(Ue),null,{default:r(()=>[B("span",null,I(m.$t("name")),1),i(e(Ae),{modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=V=>a.value=V),size:"small",placeholder:m.$t("type-to-search"),"prefix-icon":e(xe),style:{width:"200px"}},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1},8,["label"])]),_:1},8,["data"])),[[S,o.value]]),b.value.length>0?(c(),h("div",Ke,[i(e(F),{type:"primary",onClick:H},{default:r(()=>[w(I(m.$t("confirm")),1)]),_:1})])):P("",!0)],64)}}});function ue(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["zh-CN"]=new $(`craft-type = 制作类型
name = 名称

type-to-search = 输入以搜索
confirm = 确认`)}function de(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["zh-TW"]=new $(`craft-type = 製作職業
name = 名稱

type-to-search = 輸入以搜尋
confirm = 確認`)}function ce(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["en-US"]=new $(`craft-type = Craft Type
name = Name

type-to-search = Type to search
confirm = Confirm`)}typeof ue=="function"&&ue(L);typeof de=="function"&&de(L);typeof ce=="function"&&ce(L);const Qe=J(L,[["__scopeId","data-v-a6401d84"]]),Xe={version:"1.1",baseProfile:"full",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"},Ye={id:"cut-off"},et=["x","y","width","height"],tt={"clip-path":"url(#cut-off)"},nt=Z({__name:"Curves",props:{relations:{},clipZone:{}},setup(t,{expose:n}){const g=T("canvas"),p=new Map([["required",D("--el-color-danger",g)],["crafted",D("--el-color-warning",g)],["completed",D("--el-color-success",g)],["not-required",D("--el-color-info",g)]]);function a(y){const{p1:o,p2:u,type:v}=y.rects,b=(o.y-u.y)/2;return Ie("path",{d:`M ${o.x} ${o.y} C ${o.x} ${o.y-b} ${u.x} ${u.y+b} ${u.x} ${u.y}`,stroke:p.get(v??"")?.value??"white",fill:"transparent"})}return n({}),(y,o)=>(c(),h("div",{class:"canvas",ref_key:"canvas",ref:g},[(c(),h("svg",Xe,[B("defs",null,[B("clipPath",Ye,[B("rect",{x:t.clipZone.x.value,y:t.clipZone.y.value,width:t.clipZone.width.value,height:t.clipZone.height.value},null,8,et)])]),B("g",tt,[(c(!0),h(x,null,R(t.relations,u=>(c(),q(a,{rects:u},null,8,["rects"]))),256))])]))],512))}}),lt=J(nt,[["__scopeId","data-v-38df463f"]]),at={class:"page"},it={class:"item button-group",key:"button-group"},ot={class:"row ings-row"},O=Z({__name:"Bom",emits:["setTitle"],setup(t,{emit:n}){const g=n;ke(()=>g("setTitle","bill-of-material"));const{$t:p}=qe(),a=Le(),y=k(!1),o=k(),u=k(!1),v=k(!0),b=T("page"),j=T("target-items"),H=T("ing-items"),W=ee(b),z=K(()=>{if(a.ingredients.length==0)return[];const f=a.ingredients[a.ingredients.length-1].depth,s=Array.from({length:f});for(const l of a.ingredients)s[l.depth]==null?s[l.depth]=[l]:s[l.depth].push(l);return s.splice(1)});function m(...f){y.value=!1,a.addTarget(...f),V(),a.targetItems.length>6&&(v.value=!1)}function _(){a.targetItems.splice(0),V()}let S;async function V(){let f;try{o.value=void 0,u.value=!0,f=a.updateBom(),S=f,await f,G.value=new Map([j.value,H.value].filter(s=>s!=null).flatMap(s=>s.filter(l=>l.$el!=null).map(l=>[l.id,ee(l.$el)])))}catch(s){o.value=String(s)}finally{f==S&&(S=void 0,u.value=!1)}}const ge=K(()=>new Map(a.ingredients.map(f=>[f.item.id,f])));let G=k(new Map),N=Ne(new Set);const ye=K(()=>{const f=[],s=!v.value;if(s&&N.size==0)return[];for(const[l,d]of G.value){const E=ge.value.get(l);if(E!=null)for(const[X,ve]of E.requiredBy){if(s&&!(N.has(l)||N.has(X)))continue;const U=G.value.get(X);U!=null&&f.push({p1:{x:d.x+d.width/2,y:d.top},p2:{x:U.x+U.width/2,y:U?.bottom},type:ve==0?"not-required":E.type})}}return f});return(f,s)=>(c(),q(e(Pe),{ref_key:"page",ref:b},{default:r(()=>[i(e(De),{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=l=>y.value=l),title:e(p)("select-recipe")},{default:r(()=>[i(Qe,{onClickItem:m,onSelectItems:s[0]||(s[0]=l=>m(...l))})]),_:1},8,["modelValue","title"]),B("div",at,[i(Ee,{class:"row",tag:"div"},{default:r(()=>[B("div",it,[i(e(F),{onClick:s[2]||(s[2]=l=>y.value=!0),style:{width:"100%",flex:"auto"},type:"primary",icon:e(Be)},{default:r(()=>[w(I(e(p)("add")),1)]),_:1},8,["icon"]),i(e(F),{onClick:_,style:{width:"100%",margin:"10px 0 0 0",flex:"auto"},icon:e(Me)},{default:r(()=>[w(I(e(p)("clear")),1)]),_:1},8,["icon"]),i(e(Fe),{modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=l=>v.value=l),"active-text":e(p)("display-relations")},null,8,["modelValue","active-text"])]),(c(!0),h(x,null,R(e(a).targetItems,l=>(c(),q(re,{class:"item",ref_for:!0,ref:"target-items",id:l.item.id,name:l.item.name,key:l.item.id,"required-number":l.getFixRequiredNumber(),"onUpdate:requiredNumber":d=>{l.setFixRequiredNumber(d),e(a).updateBom()},"holding-number":e(a).holdingItems.get(l.item.id)??0,"onUpdate:holdingNumber":d=>{e(a).holdingItems.set(l.item.id,d),e(a).updateBom()},type:l.type,onMouseenter:d=>e(N).add(l.item.id),onMouseleave:d=>e(N).delete(l.item.id)},null,8,["id","name","required-number","onUpdate:requiredNumber","holding-number","onUpdate:holdingNumber","type","onMouseenter","onMouseleave"]))),128))]),_:1}),i(e(Ce),{"content-position":"left"},{default:r(()=>[i(e(A),null,{default:r(()=>[u.value?(c(),h(x,{key:0},[e(a).fetchingItem?(c(),q(e(A),{key:0,type:"info"},{default:r(()=>[w(I(e(a).fetchingItem!=null?e(p)("fetching-item",{itemName:e(a).fetchingItem}):e(p)("calculating")),1)]),_:1})):P("",!0),i(e(te),{class:"is-loading"},{default:r(()=>[i(e(Se))]),_:1})],64)):(c(),h(x,{key:1},[w(I(e(p)("ings"))+" ",1),i(e(F),{onClick:s[4]||(s[4]=l=>V()),text:""},{default:r(()=>[i(e(te),null,{default:r(()=>[i(e(Ve))]),_:1})]),_:1})],64))]),_:1})]),_:1}),o.value?(c(),q(e(Re),{key:0,type:"error","show-icon":"",closable:!1},{default:r(()=>[w(I(o.value),1)]),_:1})):P("",!0),(c(!0),h(x,null,R(z.value,l=>(c(),h("div",ot,[(c(!0),h(x,null,R(l,d=>(c(),q(re,{class:"item",ref_for:!0,ref:"ing-items",key:d.item.id,id:d.item.id,name:d.item.name,wasted:d.wasted,"required-number":d.requiredNumber(),requiredInputDisabled:"","holding-number":e(a).holdingItems.get(d.item.id)??0,"onUpdate:holdingNumber":E=>{e(a).holdingItems.set(d.item.id,E),e(a).updateBom()},type:d.type,onMouseenter:E=>e(N).add(d.item.id),onMouseleave:E=>e(N).delete(d.item.id)},null,8,["id","name","wasted","required-number","holding-number","onUpdate:holdingNumber","type","onMouseenter","onMouseleave"]))),128))]))),256)),i(lt,{relations:ye.value,"clip-zone":e(W)},null,8,["relations","clip-zone"])])]),_:1},512))}});function me(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["zh-CN"]=new $(`ings = 材料
calculating = 计算中
fetching-item = 正在查询 { $itemName }
add = 添加
clear = 清空
display-relations = 显示依赖关系`)}function fe(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["en-US"]=new $(`ings = Ingredients
calculating = Calculating
fetching-item = Fetching { $itemName }
add = Add
clear = Clear
display-relations = Display Relations`)}function pe(t){const n=t.options||t;n.fluent=n.fluent||{},n.fluent["ja-JP"]=new $(`ings = コンポーネント
calculating = ずるい
fetching-item = つかむ { $itemName }
add = 追加
clear = パージ
display-relations = 表示関係`)}typeof me=="function"&&me(O);typeof fe=="function"&&fe(O);typeof pe=="function"&&pe(O);const Bt=J(O,[["__scopeId","data-v-d14a20be"]]);export{Bt as default};
//# sourceMappingURL=Bom-29vvm5_T.js.map
