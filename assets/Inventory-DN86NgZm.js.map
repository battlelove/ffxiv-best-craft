{"version":3,"mappings":"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","names":["$t","useFluent","inventoryStore","useInventoryStore","useSettingsStore","showItemSelector","ref","solving","solvedRecipes","inventoryItemDetails","resolveItemNames","list","getLocalItemName","__vitePreload","item","localName","onMounted","watch","inventoryListWithInfo","computed","searchItems","page","query","settingsStore","localResultsPromise","searchLocalItemsFuzzy","m","cafeMakerPromise","url","data","r","e","recipeSourcePromise","localRes","cafeRes","recipeRes","combined","finalResults","calcTotalPages","handleItemSelect","updateAmount","id","val","removeItem","clearInventory","runSolver","ElMessage","inventoryIds","i","chunk","checkedCount","maxCheck","candidates","itemId","amount","findRecipesUsingItem","localRecipes","lr","totalIngs","presentIngs","maxCraft","missing","ing","inBag","canMake","a","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_unref","_hoisted_2","_hoisted_3","_createVNode","ElButton","Plus","_hoisted_4","_hoisted_5","ElTable","ElTableColumn","_withCtx","scope","ElInputNumber","$event","Delete","_hoisted_6","_hoisted_7","_hoisted_8","_toDisplayString","_createBlock","b","ElProgress","_hoisted_9","_hoisted_10","_Fragment","ItemSelector"],"ignoreList":[],"sources":["../../src/pages/Inventory.vue"],"sourcesContent":["<template>\n    <div class=\"inventory-page\">\n        <h2>{{ $t('inventory-management') }}</h2>\n        \n        <!-- Add Item Section -->\n        <div class=\"section-card\">\n            <div class=\"search-bar\">\n                <el-button @click=\"showItemSelector = true\" :icon=\"Plus\" type=\"primary\">\n                    {{ $t('add-item') }}\n                </el-button>\n            </div>\n            \n\n        </div>\n\n        <!-- Inventory List -->\n        <div class=\"section-card\">\n            <div class=\"header-row\">\n                <h3>{{ $t('my-inventory') }}</h3>\n                <el-button type=\"danger\" link @click=\"clearInventory\">{{ $t('clear-all') }}</el-button>\n            </div>\n            \n            <el-table :data=\"inventoryListWithInfo\" style=\"width: 100%\" max-height=\"400\">\n                <el-table-column prop=\"name\" :label=\"$t('item-name')\" />\n                <el-table-column :label=\"$t('quantity')\" width=\"200\">\n                    <template #default=\"scope\">\n                        <el-input-number \n                            v-model=\"scope.row.amount\" \n                            :min=\"1\" \n                            size=\"small\"\n                            @change=\"(val:number) => updateAmount(scope.row.id, val)\"\n                        />\n                    </template>\n                </el-table-column>\n                <el-table-column width=\"100\" align=\"right\">\n                    <template #default=\"scope\">\n                        <el-button type=\"danger\" :icon=\"Delete\" circle size=\"small\" @click=\"removeItem(scope.row.id)\" />\n                    </template>\n                </el-table-column>\n            </el-table>\n        </div>\n\n        <!-- Solver Section -->\n        <div class=\"section-card solver-section\">\n            <div class=\"header-row\">\n                <h3>{{ $t('crafting-solver') }}</h3>\n                <el-button type=\"success\" @click=\"runSolver\" :loading=\"solving\">{{ $t('analyze-recipes') }}</el-button>\n            </div>\n            <p class=\"hint-text\">{{ $t('solver-hint') }}</p>\n\n            <el-table v-if=\"solvedRecipes.length > 0\" :data=\"solvedRecipes\" style=\"width: 100%\">\n                <el-table-column prop=\"name\" :label=\"$t('recipe-name')\" />\n                <el-table-column :label=\"$t('completeness')\" width=\"180\" sortable :sort-method=\"(a,b) => a.completeness - b.completeness\">\n                    <template #default=\"scope\">\n                        <el-progress \n                            :percentage=\"Math.round(scope.row.completeness * 100)\" \n                            :status=\"scope.row.completeness === 1 ? 'success' : 'warning'\"\n                        />\n                    </template>\n                </el-table-column>\n                <el-table-column :label=\"$t('max-craftable')\" width=\"120\" align=\"center\" prop=\"maxCraftable\" />\n                <el-table-column :label=\"$t('missing-materials')\">\n                    <template #default=\"scope\">\n                        <div v-if=\"scope.row.missing.length === 0\" class=\"success-text\">{{ $t('ready-to-craft') }}</div>\n                        <div v-else class=\"missing-list\">\n                            <span v-for=\"m in scope.row.missing\" :key=\"m.id\" class=\"missing-item\">\n                                {{ m.name }} x{{ m.amount }}\n                            </span>\n                        </div>\n                    </template>\n                </el-table-column>\n            </el-table>\n        </div>\n        <ItemSelector \n            v-model=\"showItemSelector\" \n            :title=\"$t('select-item')\"\n            mode=\"item\"\n            :custom-search=\"searchItems\"\n            @select=\"handleItemSelect\"\n        />\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue';\nimport { \n    ElInput, ElButton, ElTag, ElTable, ElTableColumn, ElInputNumber, ElIcon, ElProgress, ElMessage \n} from 'element-plus';\nimport { Search, Plus, Delete } from '@element-plus/icons-vue';\nimport { useFluent } from 'fluent-vue';\nimport useInventoryStore from '@/stores/inventory';\nimport useSettingsStore from '@/stores/settings';\nimport { BetaXivApiRecipeSource, BetaXivapiBase } from '@/datasource/beta-xivapi-source';\nimport { Item } from '@/libs/Craft';\n\nimport ItemSelector from '@/components/ItemSelector.vue';\n\nconst { $t } = useFluent();\nconst inventoryStore = useInventoryStore();\nconst settingsStore = useSettingsStore();\n\nconst showItemSelector = ref(false);\n\nconst solving = ref(false);\nconst solvedRecipes = ref<SolvedRecipe[]>([]);\n\n// Using BetaXivApi explicitly for searching\nconst xivApi = new BetaXivApiRecipeSource(BetaXivapiBase, 'zh'); // Force ZH for now or use settings\n\ninterface SolvedRecipe {\n    id: number;\n    name: string;\n    completeness: number; // 0-1\n    maxCraftable: number;\n    missing: { id: number, name: string, amount: number }[];\n}\n\n// Enhance inventory list with names (basic for now, ideally cache this)\nconst inventoryItemDetails = ref<Map<number, string>>(new Map());\n\nimport { onMounted, watch } from 'vue';\n\nasync function resolveItemNames() {\n    const list = inventoryStore.itemList;\n    if (!list) return;\n    \n    // Import local map dynamically\n    const { getLocalItemName } = await import('@/libs/ItemMap');\n    \n    // For each item, try to find a name\n    for (const item of list) {\n        if (inventoryItemDetails.value.has(item.id)) continue;\n\n        // 1. Local Lookup\n        const localName = getLocalItemName(item.id);\n        if (localName) {\n            inventoryItemDetails.value.set(item.id, localName);\n            continue;\n        }\n\n        // 2. Try DataSource (SettingsStore) - if it's a recipe\n        // This is expensive to do one by one if not cached. \n        // Note: DataSources (like beta-xivapi) usually search by name or recipe ID, not Item ID directly unless we implement it.\n        // But for MVP, if we can't find it locally, we might skip or try CafeMaker item fetch?\n        \n        // Let's try to query SettingsStore (Recipe Source) which might have generic Item lookup?\n        // Actually, existing `xivApi` in this file is `BetaXivApiRecipeSource`.\n        // It has `recipeTable` but maybe not direct item lookup by ID unless we dig into `BetaXivapiBase`.\n        \n        // Fallback: Just show ID if not found locally for now, \n        // OR implement a batch lookup if possible.\n        // Since user provided LOCAL TABLE, that is the primary source.\n    }\n}\n\nonMounted(() => {\n    resolveItemNames();\n});\n\n// Watch for changes in inventory list to resolve new items\nwatch(() => inventoryStore.itemList, () => {\n    resolveItemNames();\n}, { deep: true });\n\nconst inventoryListWithInfo = computed(() => {\n    const list = inventoryStore.itemList;\n    if (!list || !Array.isArray(list)) return [];\n    return list.map(item => ({\n        ...item,\n        name: inventoryItemDetails.value.get(item.id) || `Item #${item.id}`\n    }));\n});\n\n// Custom search function for ItemSelector to find Items (not just recipes)\nasync function searchItems(page: number, query: string): Promise<{ results: any[], totalPages: number }> {\n    const settingsStore = useSettingsStore();\n\n    // 0. Local Lookup (Traditional Chinese Override)\n    // Always include local results on the first page to ensure highest priority matches appear immediately.\n    const localResultsPromise = (async () => {\n        if (page > 1) return []; \n        const { searchLocalItemsFuzzy } = await import('@/libs/ItemMap'); \n        const matches = searchLocalItemsFuzzy(query);\n        return matches.map(m => ({\n            id: m.id,\n            name: m.name,\n            level: 1, \n            can_be_hq: false,\n            is_recipe: false,\n            is_local: true\n        }));\n    })();\n\n    // 1. Search CafeMaker (Item Search - Good for Raw Materials & generic items, supports Simplified Chinese)\n    // Note: CafeMaker might catch some recipes too as items.\n    const cafeMakerPromise = (async () => {\n        try {\n            // CafeMaker works best with Simplified Chinese. \n            // Ideally we'd convert TC -> SC, but for now we pass query directly.\n            const url = `https://cafemaker.wakingsands.com/search?string=${encodeURIComponent(query)}&indexes=Item&limit=20&page=${page}`;\n            const resp = await fetch(url, { mode: 'cors' });\n            const data = await resp.json();\n            if (!data.Results) return [];\n            return data.Results.map((r: any) => ({\n                id: r.ID,\n                name: r.Name,\n                level: 1, // CafeMaker search doesn't provide level\n                can_be_hq: false,\n                is_recipe: false\n            }));\n        } catch (e) {\n            console.warn(\"CafeMaker search failed\", e);\n            return [];\n        }\n    })();\n\n    // 2. Search DataSource (Recipe Search - Good for Recipes, uses configured language e.g. TC/EN)\n    // This replicates the behavior of the \"List Page\" selector.\n    const recipeSourcePromise = (async () => {\n        try {\n             // We only want the first page of recipe results to mix in, or match the pagination?\n             // DataSource pagination is separate. For simplicity in this hybrid mode:\n             // - If page > 1, maybe skip recipe search if we treat it as infinite scroll?\n             // But for now let's just query it.\n             const ds = await settingsStore.getDataSource();\n             const res = await ds.recipeTable(page, query);\n             return res.results.map(r => ({\n                id: r.item_id, // We want the ITEM ID here, not recipe ID, for the selector.\n                name: r.item_name,\n                level: r.rlv,\n                can_be_hq: r.can_hq,\n                is_recipe: true,\n                // store generic info\n                original_recipe: r \n             }));\n        } catch (e) {\n            console.warn(\"DataSource search failed\", e);\n            return [];\n        }\n    })();\n\n    const [localRes, cafeRes, recipeRes] = await Promise.all([localResultsPromise, cafeMakerPromise, recipeSourcePromise]);\n\n    // 3. Merge & Deduplicate\n    // Priority: Local > Recipe Source > CafeMaker\n    // We leverage Map behavior: later set() overwrites earlier ones.\n    const combined = new Map<number, any>();\n\n    // Lowest Priority: CafeMaker\n    cafeRes.forEach(r => combined.set(r.id, r));\n\n    // Medium Priority: Recipe\n    recipeRes.forEach(r => combined.set(r.id, r));\n\n    // Highest Priority: Local Lookup\n    localRes.forEach(r => combined.set(r.id, r));\n\n    const finalResults = Array.from(combined.values());\n    \n    // Normalize Names to Local (TC) if available\n    // This ensures that even if a result came from CafeMaker (SC), we show the TC name.\n    const { getLocalItemName } = await import('@/libs/ItemMap');\n    for (const r of finalResults) {\n        const localName = getLocalItemName(r.id);\n        if (localName) {\n            r.name = localName;\n        }\n    }\n    \n    // Pagination Logic Fix\n    let calcTotalPages = page;\n    if (cafeRes.length >= 20 || recipeRes.length >= 20 || localRes.length >= 50) {\n        calcTotalPages = page + 1;\n    }\n    \n    return {\n        results: finalResults,\n        totalPages: calcTotalPages \n    };\n}\n\nfunction handleItemSelect(item: { id: number; name: string }) {\n    inventoryStore.addItem(item.id, 1);\n    inventoryItemDetails.value.set(item.id, item.name);\n}\n\nfunction updateAmount(id: number, val: number) {\n    inventoryStore.setItem(id, val);\n}\n\nfunction removeItem(id: number) {\n    inventoryStore.removeItem(id);\n}\n\nfunction clearInventory() {\n    inventoryStore.clear();\n}\n\nasync function runSolver() {\n    if (inventoryStore.itemList.length === 0) {\n        ElMessage.warning($t('inventory-empty'));\n        return;\n    }\n    \n    solving.value = true;\n    solvedRecipes.value = [];\n    \n    try {\n        // 1. Get List of Ingredients\n        const inventoryIds = inventoryStore.itemList.map(i => i.id);\n        \n        // 2. Reverse Lookup: Find recipes using these ingredients\n        // XivApi: search?sheets=Recipe&query=ItemIngredient0.row_id=123 + ...\n        // Query might be too long. We should query for each item? \n        // Or use \"Ingredient.row_id\" if XivApi supports it (array check).\n        \n        // Strategy: Query recipes that contain ANY of these ingredients.\n        // \"Recipe\" sheet has \"Ingredient\" array (raw).\n        // Query: `Ingredient=<id1> OR Ingredient=<id2>...`\n        // Max URL length is concern.\n        \n        // Let's chunk it.\n        const chunk = inventoryIds.slice(0, 5); // Limit to 5 items for test/performance\n        if (inventoryIds.length > 5) {\n             ElMessage.info($t('solver-limit-warning'));\n        }\n        // Optimization: Only check for the first few items or \"valuable\" items to avoid spamming API?\n        // Analyzing ALL items is slow (N items * API call).\n        // Let's increment.\n        \n        let checkedCount = 0;\n        const maxCheck = 20; // Increased limit for local search as it is fast\n        const candidates = new Map<number, SolvedRecipe>(); // Restore candidates map\n        \n        for (const [itemId, amount] of inventoryStore.items.entries()) {\n            if (checkedCount >= maxCheck) break;\n            checkedCount++;\n            \n            // Skip crystals (IDs 2-19) as they return too many recipes\n            if (itemId >= 2 && itemId <= 19) continue; \n            \n            // Local Lookup using RecipeMap\n            const { findRecipesUsingItem } = await import('@/libs/RecipeMap');\n            const localRecipes = findRecipesUsingItem(itemId);\n            \n            for (const lr of localRecipes) {\n                 // Use Result Item ID as key (or we need a unique recipe ID, but result ID is okay-ish if 1 item = 1 recipe mostly)\n                 // Or we generate a pseudo ID? \n                 // The 'lr' structure doesn't have a unique ID. \n                 // Let's use resultItemId as key. If conflicting (multiple recipes for same item), we might overwrite.\n                 // For simplified solver, this is acceptable.\n                 \n                 if (candidates.has(lr.resultItemId)) continue;\n                 \n                  // Calculate completeness locally\n                   let totalIngs = 0;\n                   let presentIngs = 0;\n                   let maxCraft = 999;\n                   const missing = [];\n                   \n                   for (const ing of lr.ingredients) {\n                       const inBag = inventoryStore.items.get(ing.id) || 0;\n                       \n                       // Limiting factor\n                       const canMake = Math.floor(inBag / ing.amount);\n                       if (canMake < maxCraft) maxCraft = canMake;\n                       \n                       if (inBag >= ing.amount) {\n                           presentIngs++;\n                       } else {\n                           missing.push({\n                               id: ing.id,\n                               name: ing.name,\n                               amount: ing.amount - inBag\n                           });\n                       }\n                       totalIngs++;\n                   }\n                   \n                   candidates.set(lr.resultItemId, {\n                       id: lr.resultItemId,\n                       name: lr.name,\n                       completeness: totalIngs > 0 ? presentIngs / totalIngs : 0,\n                       maxCraftable: maxCraft,\n                       missing: missing\n                   });\n            }\n        }\n        \n        // Sort: 100% complete first, then descending\n        solvedRecipes.value = Array.from(candidates.values())\n            .filter(r => r.completeness > 0.1) // Filter very low relevance\n            .sort((a, b) => b.completeness - a.completeness);\n\n    } catch (e) {\n        console.error(e);\n        ElMessage.error($t('solver-error') + ': ' + String(e));\n    } finally {\n        solving.value = false;\n    }\n}\n</script>\n\n<style scoped>\n.inventory-page {\n    padding: 20px;\n    height: 100%;\n    overflow-y: auto;\n}\n.section-card {\n    background: var(--el-bg-color-overlay);\n    padding: 20px;\n    border-radius: 8px;\n    margin-bottom: 20px;\n}\n.search-bar {\n    display: flex;\n    align-items: center;\n}\n.search-results {\n    margin-top: 10px;\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n.search-result-item {\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.search-result-item:hover {\n    background-color: var(--el-color-primary-light-9);\n}\n.add-icon {\n    margin-left: 5px;\n}\n.header-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 15px;\n}\n.missing-list {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n.missing-item {\n    font-size: 0.85em;\n    color: var(--el-color-danger);\n}\n.success-text {\n    color: var(--el-color-success);\n    font-weight: bold;\n}\n.hint-text {\n    font-size: 0.9em;\n    color: var(--el-text-color-secondary);\n    margin-bottom: 10px;\n}\n</style>\n\n<fluent locale=\"zh-CN\">\ninventory-management = 背包管理\nadd-item = 添加物品\nselect-item = 选择物品\nsearch-item-placeholder = 搜索物品以添加...\nmy-inventory = 我的素材\nclear-all = 清空\nitem-name = 物品名称\nquantity = 数量\ncrafting-solver = 制作求解器 (Solver)\nanalyze-recipes = 分析可制作配方\nsolver-hint = 提示：目前仅分析前5個素材，且使用XIVAPI数据。如有不准确请见谅。\nrecipe-name = 配方名称\ncompleteness = 完整度\nmax-craftable = 可制作数量\nmissing-materials = 缺少的素材\nready-to-craft = 素材齐备！\ninventory-empty = 背包是空的，请先添加素材。\nsolver-limit-warning = 为避免过载，目前仅使用前5个素材进行分析。\nsolver-error = 分析失败\n</fluent>\n\n<fluent locale=\"zh-TW\">\ninventory-management = 背包管理\nadd-item = 新增物品\nselect-item = 選擇物品\nsearch-item-placeholder = 搜尋物品以新增...\nmy-inventory = 我的素材\nclear-all = 清空\nitem-name = 物品名稱\nquantity = 數量\ncrafting-solver = 製作求解器 (Solver)\nanalyze-recipes = 分析可製作配方\nsolver-hint = 提示：目前僅分析前5個素材，且使用XIVAPI數據。如有不準確請見諒。\nrecipe-name = 配方名稱\ncompleteness = 完整度\nmax-craftable = 可製作數量\nmissing-materials = 缺少素材\nready-to-craft = 素材齊全！\ninventory-empty = 背包是空的，請先新增素材。\nsolver-limit-warning = 為避免過載，目前僅使用前5個素材進行分析。\nsolver-error = 分析失敗\n</fluent>\n\n<fluent locale=\"en-US\">\ninventory-management = Inventory Management\nadd-item = Add Item\nselect-item = Select Item\nsearch-item-placeholder = Search items to add...\nmy-inventory = My Inventory\nclear-all = Clear All\nitem-name = Item Name\nquantity = Quantity\ncrafting-solver = Crafting Solver\nanalyze-recipes = Analyze Recipes\nsolver-hint = Note: Analyzes only first 5 items due to API limits.\nrecipe-name = Recipe Name\ncompleteness = Completeness\nmax-craftable = Max Craftable\nmissing-materials = Missing Materials\nready-to-craft = Ready to Craft!\ninventory-empty = Inventory is empty.\nsolver-limit-warning = Only first 5 items are used for analysis.\nsolver-error = Analysis Failed\n</fluent>\n\n<fluent locale=\"ja-JP\">\ninventory-management = 所持品管理\nadd-item = アイテム追加\nselect-item = アイテムを選択\nsearch-item-placeholder = アイテムを検索して追加...\nmy-inventory = 所持素材\nclear-all = クリア\nitem-name = アイテム名\nquantity = 数量\ncrafting-solver = 製作ソルバー\nanalyze-recipes = レシピを分析\nsolver-hint = ヒント：API制限のため、最初の5つのアイテムのみ分析されます。\nrecipe-name = レシピ名\ncompleteness = 完成度\nmax-craftable = 製作可能数\nmissing-materials = 不足素材\nready-to-craft = 製作可能！\ninventory-empty = 所持品が空です。\nsolver-limit-warning = 最初の5つのアイテムのみ分析に使用されます。\nsolver-error = 分析失敗\n</fluent>\n"],"file":"Inventory-DN86NgZm.js"}